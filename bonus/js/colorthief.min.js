/*
 * Color Thief v2.0
 * by Lokesh Dhakar - http://www.lokeshdhakar.com
 *
 * License
 * -------
 * Creative Commons Attribution 2.5 License:
 * http://creativecommons.org/licenses/by/2.5/
 *
 * Thanks
 * ------
 * Nick Rabinowitz - For creating quantize.js.
 * John Schulz - For clean up and optimization. @JFSIII
 * Nathan Spady - For adding drag and drop support to the demo page.
 *
 */
var CanvasImage=function(c){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");document.body.appendChild(this.canvas);this.width=this.canvas.width=c.width;this.height=this.canvas.height=c.height;this.context.drawImage(c,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)};CanvasImage.prototype.update=function(c){this.context.putImageData(c,0,0)};
CanvasImage.prototype.getPixelCount=function(){return this.width*this.height};CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};ColorThief.prototype.getColor=function(c,d){return this.getPalette(c,5,d)[0]};
ColorThief.prototype.getPalette=function(c,d,k){"undefined"===typeof d&&(d=10);"undefined"===typeof k&&(k=10);c=new CanvasImage(c);for(var t=c.getImageData().data,u=c.getPixelCount(),v=[],w=0,p,q,x,b;w<u;w+=k)p=4*w,q=t[p+0],x=t[p+1],b=t[p+2],p=t[p+3],125<=p&&(250<q&&250<x&&250<b||v.push([q,x,b]));d=MMCQ.quantize(v,d).palette();c.removeCanvas();return d};
if(!pv)var pv={map:function(c,d){var k={};return d?c.map(function(c,u){k.index=u;return d.call(k,c)}):c.slice()},naturalOrder:function(c,d){return c<d?-1:c>d?1:0},sum:function(c,d){var k={};return c.reduce(d?function(c,u,v){k.index=v;return c+d.call(k,u)}:function(c,d){return c+d},0)},max:function(c,d){return Math.max.apply(null,d?pv.map(c,d):c)}};
var MMCQ=function(){function c(b,a,e){return(b<<2*p)+(a<<p)+e}function d(b){function a(){e.sort(b);c=!0}var e=[],c=!1;return{push:function(a){e.push(a);c=!1},peek:function(b){c||a();void 0===b&&(b=e.length-1);return e[b]},pop:function(){c||a();return e.pop()},size:function(){return e.length},map:function(a){return e.map(a)},debug:function(){c||a();return e}}}function k(b,a,e,c,l,f,g){this.r1=b;this.r2=a;this.g1=e;this.g2=c;this.b1=l;this.b2=f;this.histo=g}function t(){this.vboxes=new d(function(b,
a){return pv.naturalOrder(b.vbox.count()*b.vbox.volume(),a.vbox.count()*a.vbox.volume())})}function u(b){var a=Array(1<<3*p),e,z,l,f;b.forEach(function(b){z=b[0]>>q;l=b[1]>>q;f=b[2]>>q;e=c(z,l,f);a[e]=(a[e]||0)+1});return a}function v(b,a){var e=1E6,c=0,l=1E6,f=0,g=1E6,n=0,d,h,m;b.forEach(function(a){d=a[0]>>q;h=a[1]>>q;m=a[2]>>q;d<e?e=d:d>c&&(c=d);h<l?l=h:h>f&&(f=h);m<g?g=m:m>n&&(n=m)});return new k(e,c,l,f,g,n,a)}function w(b,a){function e(b){var e=b+"1";b+="2";var c,d,f,l;d=0;for(h=a[e];h<=a[b];h++)if(n[h]>
g/2){f=a.copy();l=a.copy();c=h-a[e];d=a[b]-h;for(c=c<=d?Math.min(a[b]-1,~~(h+d/2)):Math.max(a[e],~~(h-1-c/2));!n[c];)c++;for(d=y[c];!d&&n[c-1];)d=y[--c];f[b]=c;l[e]=f[b]+1;return[f,l]}}if(a.count()){var d=a.r2-a.r1+1,l=a.g2-a.g1+1,f=pv.max([d,l,a.b2-a.b1+1]);if(1==a.count())return[a.copy()];var g=0,n=[],y=[],h,m,r,s,k;if(f==d)for(h=a.r1;h<=a.r2;h++){s=0;for(m=a.g1;m<=a.g2;m++)for(r=a.b1;r<=a.b2;r++)k=c(h,m,r),s+=b[k]||0;g+=s;n[h]=g}else if(f==l)for(h=a.g1;h<=a.g2;h++){s=0;for(m=a.r1;m<=a.r2;m++)for(r=
a.b1;r<=a.b2;r++)k=c(m,h,r),s+=b[k]||0;g+=s;n[h]=g}else for(h=a.b1;h<=a.b2;h++){s=0;for(m=a.r1;m<=a.r2;m++)for(r=a.g1;r<=a.g2;r++)k=c(m,r,h),s+=b[k]||0;g+=s;n[h]=g}n.forEach(function(a,b){y[b]=g-a});return f==d?e("r"):f==l?e("g"):e("b")}}var p=5,q=8-p,x=1E3;k.prototype={volume:function(b){if(!this._volume||b)this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1);return this._volume},count:function(b){var a=this.histo;if(!this._count_set||b){b=0;var e,d,l;for(e=this.r1;e<=this.r2;e++)for(d=
this.g1;d<=this.g2;d++)for(l=this.b1;l<=this.b2;l++)index=c(e,d,l),b+=a[index]||0;this._count=b;this._count_set=!0}return this._count},copy:function(){return new k(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(b){var a=this.histo;if(!this._avg||b){b=0;var e=1<<8-p,d=0,l=0,f=0,g,n,k,h;for(n=this.r1;n<=this.r2;n++)for(k=this.g1;k<=this.g2;k++)for(h=this.b1;h<=this.b2;h++)g=c(n,k,h),g=a[g]||0,b+=g,d+=g*(n+0.5)*e,l+=g*(k+0.5)*e,f+=g*(h+0.5)*e;this._avg=b?[~~(d/b),~~(l/b),~~(f/
b)]:[~~(e*(this.r1+this.r2+1)/2),~~(e*(this.g1+this.g2+1)/2),~~(e*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(b){var a=b[0]>>q;gval=b[1]>>q;bval=b[2]>>q;return a>=this.r1&&a<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}};t.prototype={push:function(b){this.vboxes.push({vbox:b,color:b.avg()})},palette:function(){return this.vboxes.map(function(b){return b.color})},size:function(){return this.vboxes.size()},map:function(b){for(var a=this.vboxes,c=0;c<a.size();c++)if(a.peek(c).vbox.contains(b))return a.peek(c).color;
return this.nearest(b)},nearest:function(b){for(var a=this.vboxes,c,d,l,f=0;f<a.size();f++)if(d=Math.sqrt(Math.pow(b[0]-a.peek(f).color[0],2)+Math.pow(b[1]-a.peek(f).color[1],2)+Math.pow(b[2]-a.peek(f).color[2],2)),d<c||void 0===c)c=d,l=a.peek(f).color;return l},forcebw:function(){var b=this.vboxes;b.sort(function(a,b){return pv.naturalOrder(pv.sum(a.color),pv.sum(b.color))});var a=b[0].color;5>a[0]&&5>a[1]&&5>a[2]&&(b[0].color=[0,0,0]);var a=b.length-1,c=b[a].color;251<c[0]&&251<c[1]&&251<c[2]&&
(b[a].color=[255,255,255])}};return{quantize:function(b,a){function c(a,b){for(var d=1,e=0,f;e<x;)if(f=a.pop(),f.count()){var g=w(k,f);f=g[0];g=g[1];if(!f)break;a.push(f);g&&(a.push(g),d++);if(d>=b)break;if(e++>x)break}else a.push(f),e++}if(!b.length||2>a||256<a)return!1;var k=u(b),l=0;k.forEach(function(){l++});var f=v(b,k),g=new d(function(a,b){return pv.naturalOrder(a.count(),b.count())});g.push(f);c(g,0.75*a);for(f=new d(function(a,b){return pv.naturalOrder(a.count()*a.volume(),b.count()*b.volume())});g.size();)f.push(g.pop());
c(f,a-f.size());for(g=new t;f.size();)g.push(f.pop());return g}}}();
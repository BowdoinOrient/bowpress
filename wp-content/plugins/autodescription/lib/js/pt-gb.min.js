'use strict';window.tsfPTGB=function(a){var b='undefined'!=typeof tsfPTL10n&&tsfPTL10n;const{addFilter:c}=wp.hooks,{createElement:d,Fragment:e}=wp.element,{SelectControl:f}=wp.components,{addQueryArgs:g}=wp.url,h=wp.apiFetch,{invoke:i}=lodash,j={per_page:-1,orderby:'id',order:'asc',_fields:'id,name'},k=()=>{if(tsf.hasInput&&Object.keys(b.taxonomies).length){let l=b.taxonomies,m=wp.template('tsf-primary-term-selector'),n={};const o=(C,D)=>D in l[C].i18n&&l[C].i18n[D]||'',p=C=>document.getElementById(`autodescription[_primary_term_${C}]`),q=C=>+p(C).value,r=(C,D)=>+(p(C).value=+D),s=C=>{let D=document.getElementById('tsf-gutenberg-data-holder');if(!D)return n[C]=!1;let E=m({taxonomy:l[C]});return n[C]=!!a(E).appendTo(D)},t=C=>n[C],u=(C,D)=>{0>D.indexOf(q(C))&&(0 in D?r(C,D[0]):r(C,0))};(()=>{for(let C in l)s(C)})();var v={};class w{constructor(C){this.slug=C,this.reset()}registeredData(){return!!Object.keys(this.data).length}reset(){this.data={}}read(){return this.data}get(C){return C in this.data&&this.data[C]||null}set(C,D){return this.data[C]=D}}const x=C=>v[C]=new w(C),y=C=>v[C]||x(C);class z extends React.Component{constructor(C){super(C),this.state={loading:!0}}componentDidMount(){this.updateData(),this.dsAccess().registeredData()&&this.setState({loading:!1})}componentWillUnmount(){i(this.fetchRequest,['abort']),i(this.addRequest,['abort'])}componentDidUpdate(C){if(this.updateData(),2<this.props.terms.length&&!this.dsAccess().get('availableTerms'))this.fetchTerms();else if(this.props.terms!==C.terms){let E=this.props.terms.filter(F=>-1===C.terms.indexOf(F));E.length&&!this.isTermAvailable(E[0])&&this.fetchTerms()}}updateData(){this.dsAccess().registeredData()||(this.dsAccess().set('availableTerms',[]),this.fetchTerms()),this.dsAccess().set('selectedTerms',this.props.terms)}updateTerms(){this.updateData()}dsAccess(){return y(this.props.slug)}isTermAvailable(C){let D=this.dsAccess().get('availableTerms');return D.some(E=>E.id===C)}fetchTerms(){const{taxonomy:C}=this.props;C&&(this.setState({selectedTerms:this.props.terms,loading:!0}),this.fetchRequest=h({path:g(`/wp/v2/${C.rest_base}`,j)}),this.fetchRequest.then(D=>{this.fetchRequest=null,this.setState({loading:!1}),this.dsAccess().set('availableTerms',D),this.forceUpdate()},D=>{'abort'===D.statusText||(this.fetchRequest=null,this.setState({loading:!1}),this.forceUpdate())}))}}class A extends z{constructor(C){super(C),this.onChange=this.onChange.bind(this)}getTermName(C){let D=this.dsAccess().get('availableTerms'),E=D.find(F=>F.id===C);return E&&E.name||''}getSelectOptions(){return this.dsAccess().get('selectedTerms').sort().map(C=>{return{value:C,label:this.getTermName(C)}})}onChange(C){this.setState({options:this.getSelectOptions(),value:r(this.props.slug,C)}),tsf.registerChange()}isDisabled(){return!!this.state.loading}render(){return this.updateData(),d(f,{label:o(this.props.slug,'selectPrimary'),value:q(this.props.slug),className:'tsf-pt-gb-selector',onChange:this.onChange,options:this.state.loading?'':this.getSelectOptions(),disabled:this.isDisabled()})}}c('editor.PostTaxonomyType','tsf/pt',C=>class extends z{initSelectors(){const{slug:D,terms:E}=this.props;return t(D)&&(u(D,E),1<E.length)?d(e,{},d(A,this.props)):null}render(){return!this.props.slug in l?void 0:d(e,{},d(C,this.props),this.initSelectors())}},20)}};return a.extend({load:function(){a(document.body).on('tsf-onload',k)}},{})}(jQuery),jQuery(window.tsfPTGB.load);

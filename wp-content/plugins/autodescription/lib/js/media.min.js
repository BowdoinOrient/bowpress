'use strict';window.tsfMedia=function(a){var b='undefined'!=typeof tsfMediaL10n&&tsfMediaL10n,c={};const d=function(q){return q?q.replace(/(?!\\)(?=[\[\]\/])/g,'\\'):q},f=function(q){let r=a(q.target);if(r.prop('disabled')||'undefined'==typeof wp.media)return q.preventDefault(),void q.stopPropagation();let y,s=r.data('input-url'),t=r.data('input-type'),u=d(s),v=r.data('input-id'),x=d(s);q.preventDefault(),q.stopPropagation(),j();let z={suggestedWidth:r.data('width')||1200,suggestedHeight:r.data('height')||630,isFlex:'undefined'==typeof r.data('flex')?1:r.data('flex')};c.control={params:{flex_width:z.isFlex?4096:0,flex_height:z.isFlex?4096:0,width:z.suggestedWidth,height:z.suggestedHeight,isFlex:z.isFlex}},y=wp.media({button:{text:b.labels[t].imgFrameButton,close:!1},states:[new wp.media.controller.Library({title:b.labels[t].imgFrameTitle,library:wp.media.query({type:'image'}),multiple:!1,date:!1,priority:20,suggestedWidth:z.suggestedWidth,suggestedHeight:z.suggestedHeight}),new c({imgSelectOptions:k})]});const A=function(){y.setState('cropper')};y.off('select',A),y.on('select',A);const B=function(E){let F=E.url,G=E.id,H=E.width,I=E.height;jQuery('#'+v+'-url').val(F),jQuery('#'+v+'-id').val(G)};y.off('cropped',B),y.on('cropped',B);const C=function(E){let F=E.get('url'),G=E.get('id'),H=E.get('width'),I=E.get('height');jQuery('#'+v+'-url').val(F),jQuery('#'+v+'-id').val(G)};y.off('skippedcrop',C),y.on('skippedcrop',C);const D=function(){jQuery('#'+v+'-select').text(b.labels[t].imgChange),jQuery('#'+v+'-url').prop('readonly',!0).css('opacity',0).animate({opacity:1},{queue:!0,duration:1000},'swing'),g(r,{id:v,type:t},!0),tsf.registerChange()};y.off('skippedcrop cropped',D),y.on('skippedcrop cropped',D),y.open()},g=function(q,r,s){q&&r.id&&!a('#'+r.id+'-remove').length&&(q.after('<button type=button id="'+r.id+'-remove" class="tsf-remove-image-button button button-small" data-input-id="'+r.id+'" data-input-type="'+r.type+'" title="'+b.labels[r.type].imgRemoveTitle+'">'+b.labels[r.type].imgRemove+'</button>'),s&&a('#'+r.id+'-remove').css('opacity',0).animate({opacity:1},{queue:!0,duration:1000})),o()},i=function(q){let r=a(q.target).data('input-id'),s=a(q.target).data('input-type');if(!a('#'+r+'-select').prop('disabled')){a('#'+r+'-select').addClass('disabled').prop('disabled',!0),a('#'+r+'-remove').addClass('disabled').prop('disabled',!0).fadeOut(500,function(){a(this).remove(),a('#'+r+'-select').text(b.labels[s].imgSelect).removeClass('disabled').removeProp('disabled')});let t=a('#'+r+'-url');t.val(''),t.data('readonly')||t.removeProp('readonly'),t.css('opacity',0).animate({opacity:1},{queue:!0,duration:500},'swing'),a('#'+r+'-id').val(''),tsf.registerChange()}},j=function(){if('undefined'==typeof c.control){let q,s,r=wp.media.controller,t=wp.media.view;s=t.Cropper.extend({className:'crop-content tsf-image',ready:function(){t.Cropper.prototype.ready.apply(this,arguments)},onImageLoad:function(){let v,u=this.controller.get('imgSelectOptions');'function'==typeof u&&(u=u(this.options.attachment,this.controller)),'undefined'==typeof u.aspectRatio&&(u=_.extend(u,{parent:this.$el,onInit:function(){this.parent.children().on('mousedown touchstart',function(x){x.shiftKey?v.setOptions({aspectRatio:'1:1'}):v.setOptions({aspectRatio:!1})})}})),this.trigger('image-loaded'),v=this.controller.imgSelect=this.$image.imgAreaSelect(u)}}),q=r.Cropper.extend({createCropContent:function(){this.cropperView=new s({controller:this,attachment:this.get('selection').first()}),this.cropperView.on('image-loaded',this.createCropToolbar,this),this.frame.content.set(this.cropperView)},doCrop:function(u){let v=u.get('cropDetails'),x=c.control;if(x.params.flex_width&&x.params.flex_height)if(v.width===v.height)v.width>x.params.flex_width&&(v.dst_width=v.dst_height=x.params.flex_width);else if(v.width>x.params.flex_width||v.height>x.params.flex_height)if(v.width>v.height){let y=v.width/x.params.flex_width;v.dst_width=x.params.flex_width,v.dst_height=Math.round(v.height/y)}else{let y=v.height/x.params.flex_height;v.dst_height=x.params.flex_height,v.dst_width=Math.round(v.width/y)}return'undefined'==typeof v.dst_width&&(v.dst_width=0,v.dst_height=0),wp.ajax.post('tsf-crop-image',{nonce:tsf.nonces.upload_files,id:u.get('id'),context:'tsf-image',cropDetails:v})}}),q.prototype.control={},c=q}},k=function(q,r){let D,E,F,G,s=c.control,t=!!parseInt(s.params.flex_width,10),u=!!parseInt(s.params.flex_height,10),v=parseInt(s.params.width,10),x=parseInt(s.params.height,10),y=q.get('width'),z=q.get('height'),A=v/x,B=v,C=x;return G=s.params.isFlex?!l(s.params.flex_width,s.params.flex_height,y,z):A==y/z,r.set('control',s.params),r.set('canSkipCrop',G),y/z>A?(x=z,v=x*A):(v=y,x=v/A),D=(y-v)/2,E=(z-x)/2,F={handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:y,imageHeight:z,minWidth:B>v?v:B,minHeight:C>x?x:C,x1:D,y1:E,x2:v+D,y2:x+E},s.params.isFlex?u||t?(u&&(F.minHeight=200,F.maxWidth=y),t&&(F.minWidth=200,F.maxHeight=z)):F.aspectRatio=v+':'+x:(F.handles='corners',F.aspectRatio=v+':'+x),F},l=function(q,r,s,t){return s<=q&&t<=r?!1:!0},m=function(){let q=a('.tsf-set-image-button');if(q.length){let r='',s='',t='';a.each(q,function(u,v){r=a(v).data('input-id'),s=a(v).data('input-type'),t=a('#'+r+'-id'),t.length&&0<t.val()&&(a('#'+r+'-url').prop('readonly',!0),g(a(v),{id:r,type:s},!1)),a('#'+r+'-url').val()&&a('#'+r+'-select').text(b.labels[s].imgChange)})}},n=function(){a('.tsf-set-image-button').off('click',f),a('.tsf-set-image-button').on('click',f)},o=function(){a('.tsf-remove-image-button').off('click',i),a('.tsf-remove-image-button').on('click',i)},p=function(){n(),o(),a('.tsf-enable-media-if-js').removeProp('disabled').removeClass('tsf-enable-media-if-js')};return a.extend({load:function(){a(document.body).ready(p),a(document.body).ready(m)}},{})}(jQuery),jQuery(window.tsfMedia.load);

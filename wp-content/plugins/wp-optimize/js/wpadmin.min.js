var wp_optimize_send_command_admin_ajax=function(t,i,e,o){o="undefined"==typeof o||o;var n={action:"wp_optimize_ajax",subaction:t,nonce:wp_optimize_ajax_nonce,data:i};jQuery.post(ajaxurl,n,function(t){if(o){try{var i=JSON.parse(t)}catch(n){return console.log(n),console.log(t),void alert(wpoptimize.error_unexpected_response)}"undefined"!=typeof e&&e(i)}else"undefined"!=typeof e&&e(t)})};jQuery(document).ready(function(t){WP_Optimize=WP_Optimize(wp_optimize_send_command_admin_ajax)});var WP_Optimize=function(t){function i(){var t=r("#enable-schedule").is(":checked");t?r("#wp-optimize-auto-options").css("opacity","1"):r("#wp-optimize-auto-options").css("opacity","0.5")}function e(t,i,e){i="undefined"==typeof i?"#wp-optimize-wrap":i,e="undefined"==typeof e?15:e,r(t).hide().prependTo(i).slideDown("slow").delay(1e3*e).slideUp("slow",function(){r(this).remove()})}function o(i,o){var n={type:i,enable:o?1:0};r("#"+i+"_spinner").show(),t("enable_or_disable_feature",n,function(t){if(r("#"+i+"_spinner").hide(),t&&t.hasOwnProperty("output"))for(var o=0,n=t.output.length;o<n;o++){var a='<div class="updated">'+t.output[o]+"</div>";e(a,"#actions-results-area")}})}function n(){var t=r("#wp-optimize-nav-tab-contents-settings form input[name!='action'], #wp-optimize-nav-tab-contents-settings form textarea, #wp-optimize-nav-tab-contents-settings form select").serialize();return r.each(r("#wp-optimize-nav-tab-contents-settings form input[type=checkbox]").filter(function(t){return 0==r(this).prop("checked")}),function(i,e){var o="0";t+="&"+r(e).attr("name")+"="+o}),t}function a(){if(!_.get_lock())return void(c>0&&console.log("WP-Optimize: process_queue(): queue is currently locked - exiting"));c>0&&console.log("WP-Optimize: process_queue(): got queue lock");var i=_.peek();return"object"==typeof i?(data=i,i=i.optimization_id):data={},"undefined"==typeof i?(c>0&&console.log("WP-Optimize: process_queue(): queue is apparently empty - exiting"),void _.unlock()):(c>0&&console.log("WP-Optimize: process_queue(): processing item: "+i),_.dequeue(),void t("do_optimization",{optimization_id:i,data:data},function(t){if(r("#optimization_spinner_"+i).hide(),r("#optimization_checkbox_"+i).show(),r(".optimization_button_"+i).prop("disabled",!1),t){for(var e="",o=0,n=t.errors.length;o<n;o++)e+='<span class="error">'+t.errors[o]+"</span><br>";for(var o=0,n=t.messages.length;o<n;o++)e+=t.errors[o]+"<br>";for(var o=0,n=t.result.output.length;o<n;o++)e+=t.result.output[o]+"<br>";r("#optimization_info_"+i).html(e),t.hasOwnProperty("status_box_contents")&&r("#wp_optimize_status_box").css("opacity","1").find(".inside").html(t.status_box_contents),t.hasOwnProperty("table_list")&&r("#wpoptimize_table_list tbody").replaceWith(t.table_list),t.hasOwnProperty("total_size")&&r("#optimize_current_db_size").html(t.total_size),"optimizetables"==i&&data.optimization_table&&(_.is_empty()?(r("#optimization_spinner_"+i).hide(),r("#optimization_checkbox_"+i).show(),r(".optimization_button_"+i).prop("disabled",!1),r("#optimization_info_"+i).html(wpoptimize.optimization_complete)):(r("#optimization_checkbox_"+i).hide(),r("#optimization_spinner_"+i).show(),r(".optimization_button_"+i).prop("disabled",!0)))}setTimeout(function(){_.unlock(),a()},10)}))}function s(t){var i=r("#wp-optimize-nav-tab-contents-optimize .wp-optimize-settings-"+t);if(i||console.log("do_optimization: row corresponding to this optimization ("+t+") not found"),r("#optimization_checkbox_"+t).hide(),r("#optimization_spinner_"+t).show(),r(".optimization_button_"+t).prop("disabled",!0),r("#optimization_info_"+t).html("..."),"optimizetables"==t){var e=r("#wpoptimize_table_list #the-list tr");r(e).each(function(i){var e=r(this).find("td");if(table_type=e.eq(5).text(),table=e.eq(1).text(),optimizable=e.eq(5).data("optimizable"),""!=table&&"1"==optimizable){var o={optimization_id:t,optimization_table:e.eq(1).text(),optimization_table_type:table_type};_.enqueue(o)}})}else _.enqueue(t);a()}function p(){$optimizations=r("#optimizations_list .optimization_checkbox:checked"),$optimizations.sort(function(t,i){return t=r(t).closest(".wp-optimize-settings").data("optimization_run_sort_order"),i=r(i).closest(".wp-optimize-settings").data("optimization_run_sort_order"),t>i?1:t<i?-1:0});var i={};$optimizations.each(function(t){var e=r(this).closest(".wp-optimize-settings").data("optimization_id");return e?(i[e]={active:1},void s(e)):void console.log("Optimization ID corresponding to pressed button not found")}),t("save_manual_run_optimization_options",i)}var r=jQuery,c=0,_=new Updraft_Queue;i(),r("#enable-schedule").change(function(){i()}),r("#wp-optimize-disable-enable-trackbacks-enable").click(function(){o("trackbacks",!0)}),r("#wp-optimize-disable-enable-trackbacks-disable").click(function(){o("trackbacks",!1)}),r("#wp-optimize-disable-enable-comments-enable").click(function(){o("comments",!0)}),r("#wp-optimize-disable-enable-comments-disable").click(function(){o("comments",!1)}),r("#wp-optimize-nav-tab-wrapper .nav-tab").click(function(t){var i=r(this).attr("id");if(i&&"wp-optimize-nav-tab-"==i.substring(0,20)){var i=i.substring(20);t.preventDefault(),r("#wp-optimize-nav-tab-wrapper .nav-tab:not(#wp-optimize-nav-tab-"+i+")").removeClass("nav-tab-active"),r(this).addClass("nav-tab-active"),r("#wp-optimize-wrap .wp-optimize-nav-tab-contents:not(#wp-optimize-nav-tab-contents-"+i+")").hide(),r("#wp-optimize-nav-tab-contents-"+i).show()}}),r("#wp-optimize-nav-tab-contents-optimize").on("click","button.wp-optimize-settings-optimization-run-button",function(){var t=r(this).closest(".wp-optimize-settings").data("optimization_id");return t?void s(t):void console.log("Optimization ID corresponding to pressed button not found")}),r("#wp-optimize-nav-tab-contents-optimize").on("click","#wp-optimize",function(i){i.preventDefault();var e=!1;r("#enable-auto-backup").is(":checked")&&(e=!0),t("save_auto_backup_option",{auto_backup:e}),1==e&&"function"==typeof updraft_backupnow_inpage_go?updraft_backupnow_inpage_go(function(){r("#updraft-backupnow-inpage-modal").dialog("close"),p()},"","autobackup",null,1,0,0):p()}),r("#wp_optimize_table_list_refresh").click(function(){r("#wpoptimize_table_list tbody").css("opacity","0.5"),t("get_table_list",!1,function(t){r("#wpoptimize_table_list tbody").css("opacity","1"),t.hasOwnProperty("table_list")&&r("#wpoptimize_table_list tbody").replaceWith(t.table_list),t.hasOwnProperty("total_size")&&r("#optimize_current_db_size").html(t.total_size)})}),r("#wp-optimize-settings-save").click(function(i){i.preventDefault(),r("#save_spinner").show();var o=n();t("save_settings",o,function(t){if(r("#save_spinner").hide(),r("#save_done").show().delay(5e3).fadeOut(),t&&t.hasOwnProperty("save_results")&&t.save_results&&t.save_results.hasOwnProperty("errors")){for(var i=0,o=t.save_results.errors.length;i<o;i++){var n='<div class="error">'+t.errors[i]+"</div>";e(n,"#wp-optimize-settings-save-results")}console.log(t.save_results.messages)}t&&t.hasOwnProperty("status_box_contents")&&r("#wp_optimize_status_box .inside").html(t.status_box_contents),t&&t.hasOwnProperty("optimizations_table")&&r("#optimizations_list").replaceWith(t.optimizations_table),t.save_results.refresh&&location.reload()})}),r("#wp_optimize_status_box").on("click","#wp_optimize_status_box_refresh",function(i){i.preventDefault(),r("#wp_optimize_status_box").css("opacity","0.5"),t("get_status_box_contents",null,function(t){r("#wp_optimize_status_box").css("opacity","1").find(".inside").html(t)})})};